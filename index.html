<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Mellow Sundae</title>
  <link href="styles.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h2>Mellow.Sundae</h2>
    <h2>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</h2>
    
    <!-- FORM: no action/method/target, JS will handle submit -->
    <form id="regForm">
      <label for="activity">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
      <input type="text" id="activity" name="activity" readonly class="readonly-input">

      <label for="fullname">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
      <input type="text" name="fullname" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏°‡∏•‡πÇ‡∏•‡πà ‡∏ã‡∏±‡∏ô‡πÄ‡∏î‡∏¢‡πå">

      <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
      <input type="tel" name="phone" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 0823456789">

      <div id="followers-field">
        <label for="followers">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</label>
        <select name="followers">
          <option value="0 ‡∏Ñ‡∏ô">0 ‡∏Ñ‡∏ô</option>
          <option value="1 ‡∏Ñ‡∏ô">1 ‡∏Ñ‡∏ô</option>
          <option value="2 ‡∏Ñ‡∏ô">2 ‡∏Ñ‡∏ô</option>
          <option value="3 ‡∏Ñ‡∏ô">3 ‡∏Ñ‡∏ô</option>
          <option value="4 ‡∏Ñ‡∏ô">4 ‡∏Ñ‡∏ô</option>
        </select>
      </div>

      <label for="ig">IG</label>
      <input type="text" name="ig" placeholder="‡πÄ‡∏ä‡πà‡∏ô @mellow.sundae">

      <label for="first_time">‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏° Mellow.Sundae ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏∂‡πÄ‡∏õ‡∏•‡πà‡∏≤?</label>
      <select name="first_time">
        <option value="‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å">‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</option>
        <option value="‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß</option>
      </select>

      <label for="misc">Pace ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πà‡∏á</label>
      <select name="misc">
        <option value="6-30">06:30</option>
        <option value="7-30">07:30</option>
        <option value="8-30">08:30</option>
      </select>

      <button type="submit" id="submitBtn">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <p id="statusMessage" class="status-message"></p>
    </form>

    <p class="footer-note">Mellow.Sundae</p>
  </div>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyYlid-ONKPX_ERaH9F3Ak8y9u0v4iGr2kSKLFoZhQepwd5fKsB44HN2RqmTvJ_TSZj/exec";

    // ‡∏≠‡πà‡∏≤‡∏ô URL parameter
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
    const activityInput = document.getElementById("activity");
    const activityFromUrl = getQueryParam("activity");
    activityInput.value = activityFromUrl || "Mellow.Sundae Weekly Activity";

    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏õ‡∏¥‡∏î allow follower
    const allowFollowers = getQueryParam("allow_followers");
    const followersField = document.getElementById("followers-field");
    
    if (allowFollowers === "no" || allowFollowers === "false" || allowFollowers === "off") {
      followersField.innerHTML = '<p style="color:#a55">‚ö†Ô∏è ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p>';
    }

    const form = document.getElementById("regForm");
    const submitBtn = document.getElementById("submitBtn");
    const statusMessage = document.getElementById("statusMessage");

    form.addEventListener("submit", async function (e) {
      e.preventDefault(); // ‚ùó ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ form redirect

      submitBtn.disabled = true;
      submitBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
      statusMessage.textContent = "";

      // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å form ‚Üí URL-encoded (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô form POST ‡∏õ‡∏Å‡∏ï‡∏¥)
      const formData = new FormData(form);
      const body = new URLSearchParams(formData);

      try {
        await fetch(WEB_APP_URL, {
          method: "POST",
          mode: "no-cors", // ‚úÖ ‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á CORS/preflight, in-app browser friendly
          body: body
        });

        // ‡πÄ‡∏£‡∏≤‡∏≠‡πà‡∏≤‡∏ô response ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô no-cors ‡πÅ‡∏ï‡πà request ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ
        statusMessage.textContent = "‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ß‡∏¥‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤ üß°";
        statusMessage.style.color = "#1a8754";
        form.reset();
        activityInput.value = activityFromUrl || "Mellow.Sundae Weekly Activity";
      } catch (error) {
        console.error(error);
        statusMessage.textContent = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏±‡∏Å‡πÄ‡∏û‡∏à Mellow.Sundae";
        statusMessage.style.color = "#b00020";
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerText = "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
      }
    });
  </script>
</body>
</html>
