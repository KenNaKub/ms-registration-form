<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Mellow Sundae</title>
  <link href="styles.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h2>Mellow.Sundae</h2>
    <h2>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</h2>
    
    <form id="regForm">
      <label for="activity">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
      <input type="text" id="activity" name="activity" readonly class="readonly-input">

      <label for="fullname">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
      <input type="text" name="fullname" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏°‡∏•‡πÇ‡∏•‡πà ‡∏ã‡∏±‡∏ô‡πÄ‡∏î‡∏¢‡πå">

      <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
      <input type="tel" name="phone" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 0823456789">

      <div id="followers-field">
        <label for="followers">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</label>
        <select name="followers" id="followers">
          <option value="0 ‡∏Ñ‡∏ô">0 ‡∏Ñ‡∏ô</option>
          <option value="1 ‡∏Ñ‡∏ô">1 ‡∏Ñ‡∏ô</option>
          <option value="2 ‡∏Ñ‡∏ô">2 ‡∏Ñ‡∏ô</option>
          <option value="3 ‡∏Ñ‡∏ô">3 ‡∏Ñ‡∏ô</option>
          <option value="4 ‡∏Ñ‡∏ô">4 ‡∏Ñ‡∏ô</option>
          <option value="other">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏</option>
        </select>
        <input type="number" name="other_followers" id="other_followers_input" min="1" style="display: none;" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
      </div>

      <label for="ig">instagram account</label>
      <input type="text" name="ig" placeholder="‡πÄ‡∏ä‡πà‡∏ô @mellow.sundae">

      <label for="first_time">‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏° Mellow.Sundae ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏∂‡πÄ‡∏õ‡∏•‡πà‡∏≤?</label>
      <select name="first_time">
        <option value="‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å">‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</option>
        <option value="‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß</option>
      </select>

      <label for="pace">Pace ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πà‡∏á</label>
      <select name="pace">
        <option value="6-30">06:30</option>
        <option value="7-30">07:30</option>
        <option value="8-30">08:30</option>
      </select>

      <label for="plus_one">‡∏ó‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏≤ +1 (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏™‡∏ô‡∏¥‡∏ó ‡∏Ñ‡∏ô‡∏£‡∏π‡πâ‡πÉ‡∏à) ‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
      <select name="plus_one">
        <option value="‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</option>
        <option value="‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£">‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</option>
      </select>

      <div class="questionnaire-area">
        <h2>‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏ó‡∏≤‡∏á glowie</h2>

        <label>‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô</label>
        <div><input type="radio" name="age_range" value="15-18"> 15‚Äì18 ‡∏õ‡∏µ</div>
        <div><input type="radio" name="age_range" value="19-22"> 19‚Äì22 ‡∏õ‡∏µ</div>
        <div><input type="radio" name="age_range" value="23-30"> 23‚Äì30 ‡∏õ‡∏µ</div>
        <div><input type="radio" name="age_range" value="30+"> 30 ‡∏õ‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</div>

        <label>‡∏ó‡πà‡∏≤‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å Glowi√© ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÅ‡∏•‡∏∞‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÉ‡∏î</label>
        <div><input type="radio" name="know_glowie" value="social"> ‡πÇ‡∏ã‡πÄ‡∏ä‡∏µ‡∏¢‡∏•‡∏°‡∏µ‡πÄ‡∏î‡∏µ‡∏¢ (Instagram, TikTok)</div>
        <div><input type="radio" name="know_glowie" value="friend"> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ô‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å</div>
        <div><input type="radio" name="know_glowie" value="influencer"> Influencer / Content Creators</div>
        <div><input type="radio" name="know_glowie" value="marketplace"> ‡∏°‡∏≤‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ï‡πÄ‡∏û‡∏•‡∏™ (‡πÄ‡∏ä‡πà‡∏ô Shopee, Lazada)</div>
        <div><input type="radio" name="know_glowie" value="no"> ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô</div>
        <label>‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≤‡∏•‡∏¥‡∏õ‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡∏≠‡∏∞‡πÑ‡∏£</label>
        <div><input type="radio" name="lip_tone" value="pink"> ‡πÇ‡∏ó‡∏ô‡∏ä‡∏°‡∏û‡∏π</div>
        <div><input type="radio" name="lip_tone" value="orange-peach"> ‡πÇ‡∏ó‡∏ô‡∏™‡πâ‡∏°-‡∏û‡∏µ‡∏ä</div>
        <div><input type="radio" name="lip_tone" value="red"> ‡πÇ‡∏ó‡∏ô‡πÅ‡∏î‡∏á</div>
        <div><input type="radio" name="lip_tone" value="nude-brown"> ‡πÇ‡∏ó‡∏ô‡∏ô‡∏π‡πâ‡∏î-‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•</div>

        <label>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏≥‡∏≠‡∏≤‡∏á‡∏ä‡∏ô‡∏¥‡∏î‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ã‡∏∑‡πâ‡∏≠‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2 ‡∏Ç‡πâ‡∏≠)</label>
        <div><input type="checkbox" name="cosmetic_freq" value="lip"> Lipstick / Lip tint / Lip Balm / Lip oil / Lip Gloss</div>
        <div><input type="checkbox" name="cosmetic_freq" value="cheek"> Cheek/Blush</div>
        <div><input type="checkbox" name="cosmetic_freq" value="foundation"> Foundation/Skin Tint/concealer</div>
        <div><input type="checkbox" name="cosmetic_freq" value="eye"> Eye Makeup / Eye liners</div>
        <div><input type="checkbox" name="cosmetic_freq" value="brows"> Lashes & Brows</div>
        <div><input type="checkbox" name="cosmetic_freq" value="contour"> Contouring / Highlighter</div>
      </div>

      <button type="submit" id="submitBtn">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <p id="statusMessage"></p>
    </form>

    <p class="footer-note">Mellow.Sundae</p>
  </div>

  <!-- BACKDROP -->
  <div id="modalBackdrop" class="modal-backdrop"></div>

  <!-- MODAL -->
  <div id="modalBox" class="modal">
    <div class="modal-card">
      <h3 class="modal-title" id="modalTitle">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h3>

      <div class="modal-spinner" id="modalSpinner"></div>

      <div class="modal-body" id="modalBody">
        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      </div>

      <div class="modal-actions">
        <button type="button" id="modalCloseBtn" class="btn btn-primary" style="display:none;">
          ‡∏õ‡∏¥‡∏î
        </button>
      </div>
    </div>
  </div>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwakjVKxMFQxXp-rkMZplGQG02UJkLkKqvDrsKn3UnPtFGmcN5UVqR407qFyyFJSJ3V/exec";

    // ===== URL params =====
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    const activityInput   = document.getElementById("activity");
    const activityFromUrl = getQueryParam("activity");
    activityInput.value   = activityFromUrl || "Mellow.Sundae Weekly Activity";

    const allowFollowers  = getQueryParam("allow_followers");
    const followersField  = document.getElementById("followers-field");
    if (allowFollowers === "no" || allowFollowers === "false" || allowFollowers === "off") {
      followersField.innerHTML = '<p style="color:#a55">‚ö†Ô∏è ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p>';
    } else {
      const followersSelect = document.getElementById("followers");
      const otherFollowersInput = document.getElementById("other_followers_input");

      followersSelect.addEventListener("change", function() {
        if (followersSelect.value === "other") {
          otherFollowersInput.style.display = "block";
          otherFollowersInput.required = true;
        } else {
          otherFollowersInput.style.display = "none";
          otherFollowersInput.required = false;
          otherFollowersInput.value = "";
        }
      });
    }

    // ===== Form + Modal =====
    const form          = document.getElementById("regForm");
    const submitBtn     = document.getElementById("submitBtn");
    const statusMessage = document.getElementById("statusMessage");

    const modalBox      = document.getElementById("modalBox");
    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalTitle    = document.getElementById("modalTitle");
    const modalBody     = document.getElementById("modalBody");
    const modalSpinner  = document.getElementById("modalSpinner");
    const modalCloseBtn = document.getElementById("modalCloseBtn");

    function openModalLoading() {
      modalTitle.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
      modalBody.textContent  = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì";
      modalSpinner.style.display = "block";
      modalCloseBtn.style.display = "none";

      modalBox.classList.add("show");
      modalBackdrop.classList.add("show");
    }

    function openModalSuccess() {
      modalTitle.textContent = "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à üéâ";
      modalBody.textContent  = "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ß‡∏¥‡πà‡∏á‡∏Å‡∏±‡∏ö Mellow.Sundae üß°";
      modalSpinner.style.display = "none";
      modalCloseBtn.style.display = "inline-block";
    }

    function openModalError() {
      modalTitle.textContent = "‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î";
      modalBody.textContent  = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏±‡∏Å‡πÄ‡∏û‡∏à Mellow.Sundae";
      modalSpinner.style.display = "none";
      modalCloseBtn.style.display = "inline-block";
    }

    function closeModal() {
      modalBox.classList.remove("show");
      modalBackdrop.classList.remove("show");
    }

    modalCloseBtn.addEventListener("click", closeModal);

    form.addEventListener("submit", async function (e) {
      e.preventDefault();

      if (!navigator.onLine) {
        openModalError();
        modalBody.textContent = "‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå‡∏≠‡∏¢‡∏π‡πà ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
        return;
      }

      submitBtn.disabled = true;
      submitBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
      statusMessage.textContent = "";

      openModalLoading();

      const formData = new FormData(form);
      if (formData.get('followers') === 'other') {
        const otherFollowers = formData.get('other_followers');
        if (otherFollowers) {
          formData.set('followers', otherFollowers + ' ‡∏Ñ‡∏ô');
        }
        formData.delete('other_followers');
      }
      
      // Handle multiple selections for 'cosmetic_freq'
      const cosmeticChoices = formData.getAll('cosmetic_freq');
      if (cosmeticChoices.length > 0) {
        formData.set('cosmetic_freq', cosmeticChoices.join(', '));
      }

      const body     = new URLSearchParams(formData);

      try {
        await fetch(WEB_APP_URL, {
          method: "POST",
          mode: "no-cors",
          body: body
        });
      } catch (err) {
        // In 'no-cors' mode, cross-origin redirects from Google Scripts can cause
        // the fetch promise to reject, even though the data was submitted successfully.
        // We log the error but proceed as if it were a success, since we've already checked for an offline state.
        console.error("A fetch error occurred, but we are proceeding as if successful:", err);
      } finally {
        openModalSuccess();
        statusMessage.textContent = "‚úÖ ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏ß‡∏¥‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤ üß°";
        statusMessage.style.color = "#1a8754";

        form.reset();
        activityInput.value = activityFromUrl || "Mellow.Sundae Weekly Activity";
        
        // After reset, ensure the 'other' input is hidden again if it was shown
        const followersField = document.getElementById("followers-field");
        if (followersField.innerHTML.includes("followers")) {
            const followersSelect = document.getElementById("followers");
            if(followersSelect.value !== 'other') {
              document.getElementById('other_followers_input').style.display = 'none';
            }
        }

        submitBtn.disabled = false;
        submitBtn.innerText = "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
      }
    });
  </script>
</body>
</html>
