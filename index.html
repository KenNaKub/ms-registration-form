<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Mellow Sundae</title>
  <link href="styles.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">

</head>
<body>
  <div class="container">
    <h2>Mellow.Sundae</h2>
    <h2>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏á‡∏≤‡∏ô</h2>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏î‡∏¥‡∏° -->
    <form
      action="https://script.google.com/macros/s/AKfycbyJHrNJAO7MoaKUJE_V1w6PeGrD0LjPtDaDPkTljoQesiE9zR8GGH4TJ7BxoS0LDp_S/exec"
      method="POST"
      id="regForm"
    >
      <label for="activity">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label>
      <input type="text" id="activity" name="activity" readonly class="readonly-input">

      <label for="fullname">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
      <input type="text" name="fullname" required>

      <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
      <input type="tel" name="phone" required>

      <div id="followers-field">
        <label for="followers">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</label>
        <select name="followers">
          <option value="0 ‡∏Ñ‡∏ô">0 ‡∏Ñ‡∏ô</option>
          <option value="1 ‡∏Ñ‡∏ô">1 ‡∏Ñ‡∏ô</option>
          <option value="2 ‡∏Ñ‡∏ô">2 ‡∏Ñ‡∏ô</option>
          <option value="3 ‡∏Ñ‡∏ô">3 ‡∏Ñ‡∏ô</option>
          <option value="4 ‡∏Ñ‡∏ô">4 ‡∏Ñ‡∏ô</option>
        </select>
      </div>

      <label for="ig">IG</label>
      <input type="text" name="ig">

      <label for="first_time">‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏° Mellow.Sundae ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏∂‡πÄ‡∏õ‡∏•‡πà‡∏≤?</label>
      <select name="first_time">
        <option value="‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å">‡∏°‡∏≤‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</option>
        <option value="‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß">‡πÄ‡∏Ñ‡∏¢‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß</option>
      </select>

      <label for="misc">Pace ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πà‡∏á</label>
      <select name="misc">
        <option value="6-30">06:30</option>
        <option value="7-30">07:30</option>
        <option value="8-30">08:30</option>
      </select>

      <button type="submit" id="submitBtn">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>

    <p class="footer-note">Mellow.Sundae</p>
  </div>

  <!-- Modal + Backdrop -->
  <div class="modal-backdrop" id="iabBackdrop"></div>
  <div class="modal" id="iabModal" role="dialog" aria-modal="true" aria-labelledby="iabTitle">
    <div class="modal-card">
      <div class="modal-title" id="iabTitle">‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ú‡πà‡∏≤‡∏ô in-app browser</div>
      <div class="modal-body">
        ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏à‡∏≤‡∏Å <b>in-app browser</b> (‡πÄ‡∏ä‡πà‡∏ô Facebook / Instagram / LINE)
        ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        <br><br>
        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ô <b>Safari</b> ‡∏´‡∏£‡∏∑‡∏≠ <b>Chrome</b> ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
        <div style="margin-top:.5rem; color:#666">
          ‡∏ß‡∏¥‡∏ò‡∏µ‡∏•‡∏±‡∏î:
          <ul style="margin:.25rem 0 .5rem 1.25rem;">
            <li>‡πÅ‡∏ï‡∏∞ <span class="kbd">‚ãØ</span> ‡∏´‡∏£‡∏∑‡∏≠ <span class="kbd">‚Ä¶</span> ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ç‡∏ß‡∏≤ ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>Open in Browser</b></li>
            <li>‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î <b>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</b> ‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</li>
          </ul>
        </div>
      </div>
      <div class="modal-actions" style="flex-direction: column; gap: .5rem;">
        <button class="btn" id="copyLinkBtn" style="width:100%">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
      </div>
    </div>
  </div>


  <script>
    /* ---------- URL params ---------- */
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }
  
    /* ---------- IAB detection ---------- */
    function isInAppBrowser(){
      const ua = navigator.userAgent || '';
      return /FBAN|FBAV|FB_IAB|FBIOS|FB4A|Instagram|Line\/|MicroMessenger|TikTok|Twitter|wv\)|; wv/i.test(ua);
    }
  
    /* ---------- Modal helpers ---------- */
    function showIabModal(){
      const modal = document.getElementById('iabModal');
      const backdrop = document.getElementById('iabBackdrop');
      if (!modal || !backdrop) return;
      modal.classList.add('show');
      backdrop.classList.add('show');
      // ‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏ì‡∏µ CSS ‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏±‡∏ö
      modal.style.display = 'grid';
      backdrop.style.display = 'block';
    }
    function hideIabModal(){
      const modal = document.getElementById('iabModal');
      const backdrop = document.getElementById('iabBackdrop');
      if (!modal || !backdrop) return;
      modal.classList.remove('show');
      backdrop.classList.remove('show');
      modal.style.display = '';
      backdrop.style.display = '';
    }
  
    /* ---------- Init after DOM ready ---------- */
    document.addEventListener('DOMContentLoaded', function(){
      // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
      const activityInput = document.getElementById("activity");
      const activityFromUrl = getQueryParam("activity");
      if (activityInput) activityInput.value = activityFromUrl || "Mellow.Sundae Weekly Activity";
  
      // ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î followers
      const allowFollowers = (getQueryParam("allow_followers") || "").toLowerCase();
      const followersField = document.getElementById("followers-field");
      if (followersField && ["no","false","off","0"].includes(allowFollowers)) {
        followersField.innerHTML = '<p style="color:#a55">‚ö†Ô∏è ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p>';
      }
  
      // elements
      const form = document.getElementById("regForm");
      const submitBtn = document.getElementById("submitBtn");
      const copyLinkBtn = document.getElementById("copyLinkBtn");
  
      // copy current URL
      if (copyLinkBtn) {
        copyLinkBtn.addEventListener('click', async (e) => {
          e.preventDefault();
          try {
            await navigator.clipboard.writeText(window.location.href);
            copyLinkBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úì";
          } catch {
            copyLinkBtn.textContent = "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
          }
        });
      }
  
      // === TEST MODES ===
      const forceTest = getQueryParam('test_iab') === '1';
  
      // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö dev (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ file:// ‡∏´‡∏£‡∏∑‡∏≠ localhost)
      const isDevHost = location.protocol === 'file:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1';
      if (isDevHost) {
        const btn = document.createElement('button');
        btn.textContent = 'üß™ Test Modal';
        btn.style.position = 'fixed';
        btn.style.right = '12px';
        btn.style.bottom = '12px';
        btn.style.zIndex = '2000';
        btn.style.padding = '10px 14px';
        btn.style.borderRadius = '10px';
        btn.style.border = '1px solid #ddd';
        btn.style.background = '#fff8f0';
        btn.style.boxShadow = '0 6px 20px rgba(0,0,0,.15)';
        btn.onclick = () => {
          // toggle
          const visible = document.getElementById('iabModal').classList.contains('show');
          if (visible) {
            hideIabModal();
            if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'; }
          } else {
            showIabModal();
            if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Browser ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å'; }
          }
        };
        document.body.appendChild(btn);
  
        // ‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡∏±‡∏î Ctrl/‚åò + M ‚Üí toggle
        document.addEventListener('keydown', (e) => {
          const mod = e.ctrlKey || e.metaKey;
          if (mod && e.key.toLowerCase() === 'm') btn.click();
        });
      }
  
      // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô IAB ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‚Üí ‡πÇ‡∏ä‡∏ß‡πå‡πÇ‡∏°‡∏î‡∏±‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
      if (forceTest || isInAppBrowser()) {
        showIabModal();
        if (submitBtn) {
          submitBtn.disabled = true;
          submitBtn.textContent = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Browser ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å";
        }
        if (form) {
          form.addEventListener("submit", function (e) {
            e.preventDefault();
            showIabModal();
            return false;
          });
        }
      } else {
        // ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏õ‡∏Å‡∏ï‡∏¥ ‚Üí ‡∏™‡πà‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ç‡∏≠‡∏á Google Script
        if (form) {
          form.addEventListener("submit", function () {
            if (submitBtn) {
              submitBtn.disabled = true;
              submitBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
            }
          });
        }
      }
    });
  </script>
    
</body>
</html>
